# App image build reference (amd64)
#
# Prefer mise tasks â€” they handle platform flags, branch args, and tagging:
#   mise run docker:build:local          # Build from working tree
#   mise run docker:build:app            # Build from main branch
#   mise run docker:build:app testing    # Build from a specific branch
#   mise run docker:push:app             # Build + push to GHCR
#
# CI: .github/workflows/release.yml builds on v* tag push.

# LOCAL BUILDS (from project root):

# Local image from working tree (layer-cached deps):
docker build -f DockerfileLocal -t apollos-ai-local --platform linux/amd64 .

# Local image from working tree without cache:
docker build -f DockerfileLocal -t apollos-ai-local --platform linux/amd64 --no-cache .

# GIT-BASED BUILDS (from docker/run/):

# Build from a specific branch:
docker build -t apollos-ai-development \
  --platform linux/amd64 \
  --build-arg BRANCH=development \
  --build-arg CACHE_DATE=$(date +%Y-%m-%d:%H:%M:%S) .

docker build -t apollos-ai-main \
  --platform linux/amd64 \
  --build-arg BRANCH=main \
  --build-arg CACHE_DATE=$(date +%Y-%m-%d:%H:%M:%S) .

# GHCR PUSH (authenticate first: docker login ghcr.io):
docker buildx build \
  -t ghcr.io/jrmatherly/apollos-ai:latest \
  --platform linux/amd64 --push \
  --build-arg BRANCH=main \
  --build-arg CACHE_DATE=$(date +%Y-%m-%d:%H:%M:%S) .

# Verbose output:
# Append --progress=plain to any build command above.
